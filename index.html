<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Mood & Spin</title>

  <!-- iOS full-screen hints -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-180.png">

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1f2125">

  <style>
    :root{
      /* Dark gray + lavender palette */
      --bg:#1f2125;           /* page background */
      --surface:#2a2d33;      /* cards */
      --surface-2:#24262b;    /* header/footer */
      --fg:#e9e9ef;           /* text */
      --muted:#b4b5c4;        /* secondary text */
      --lav-1:#c4b5fd;        /* light lavender */
      --lav-2:#a78bfa;        /* mid lavender */
      --lav-3:#8b5cf6;        /* deep lavender */
      --accent:var(--lav-2);
      --ok:#7dd3fc;           /* cyan accents for variety */
      --warn:#fbbf24;
      --danger:#ef4444;
      --radius:16px;          /* rounded */
      --pad:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Helvetica,Arial}
    body{background:var(--bg);color:var(--fg)}

    /* Safe-area aware wrapper */
    .wrap{min-height:100dvh;display:grid;grid-template-rows:auto 1fr auto}
    header{position:sticky;top:0;background:var(--surface-2);
      padding:calc(env(safe-area-inset-top) + 8px) var(--pad) 8px var(--pad);
      display:flex;align-items:center;gap:12px;z-index:10;box-shadow:0 2px 0 rgba(0,0,0,.2)}
    h1{font-size:18px;margin:0}
    .spacer{height:8px}

    .card{margin:12px; padding:var(--pad); border-radius:var(--radius); background:var(--surface);
      box-shadow:0 10px 30px rgba(0,0,0,.25)}

    /* Buttons */
    button{appearance:none;border:0;border-radius:12px;padding:10px 12px;cursor:pointer;color:#12121a;background:#3a3d46}
    .primary{background:var(--accent);color:#1a1330;font-weight:700}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,.14);color:var(--fg)}
    .danger{background:var(--danger);color:#fff}

    .row{display:flex;gap:8px;align-items:center}
    .between{justify-content:space-between}

    /* Mood/Energy */
    .chip-row{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid rgba(255,255,255,.12);padding:8px 10px;border-radius:999px;cursor:pointer}
    .chip.active{background:linear-gradient(180deg, var(--lav-1), var(--lav-3));color:#120e1e;border-color:transparent}

    .history{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:10px}
    .dot{height:14px;border-radius:999px;background:#3a3d46}
    .dot.m1{background:#6b7280}
    .dot.m2{background:var(--lav-1)}
    .dot.m3{background:var(--lav-2)}
    .dot.m4{background:var(--lav-3)}
    .dot.m5{background:#6d28d9}

    textarea{width:100%;min-height:70px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#1e2025;color:var(--fg);padding:10px;resize:vertical}

    /* Spinner */
    .list{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .pill{padding:8px 10px;border-radius:999px;background:#333744;border:1px solid rgba(255,255,255,.1)}

    .result{margin-top:10px;padding:12px;border-radius:12px;background:#1e2025;border:1px dashed rgba(255,255,255,.15)}

    footer{background:var(--surface-2);padding:8px var(--pad) calc(env(safe-area-inset-bottom) + 8px);color:var(--muted);font-size:12px}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Mood & Spin</h1>
    <div class="row" style="margin-left:auto">
      <button id="shareBtn" class="ghost">Share</button>
      <button id="wipeBtn" class="danger">Wipe</button>
    </div>
  </header>

  <main>
    <div class="spacer"></div>

    <!-- Mood/Energy Card -->
    <section class="card" aria-labelledby="moodhdr">
      <div class="row between">
        <h2 id="moodhdr" style="margin:0;font-size:16px">Today · <span id="today"></span></h2>
        <button id="saveBtn" class="primary">Save</button>
      </div>

      <div style="height:8px"></div>
      <div class="chip-row" id="moodRow" aria-label="Mood">
        <!-- mood chips injected -->
      </div>

      <div style="height:8px"></div>
      <div class="chip-row" id="energyRow" aria-label="Energy">
        <!-- energy chips injected -->
      </div>

      <div style="height:8px"></div>
      <label for="note" class="sr-only">Note</label>
      <textarea id="note" placeholder="Add a quick note (optional)"></textarea>

      <div class="history" id="history" aria-label="Past 7 days"></div>
    </section>

    <!-- Spinner Card -->
    <section class="card" aria-labelledby="spinhdr">
      <div class="row between">
        <h2 id="spinhdr" style="margin:0;font-size:16px">Random Task Spinner</h2>
        <div class="row">
          <input id="newTask" placeholder="Add a task…" style="background:#1e2025;border:1px solid rgba(255,255,255,.12);color:var(--fg);padding:8px 10px;border-radius:10px;min-width:140px"/>
          <button id="addBtn" class="ghost">Add</button>
          <button id="spinBtn" class="primary">Spin 🎲</button>
        </div>
      </div>
      <div class="list" id="taskList"></div>
      <div id="spinResult" class="result" style="display:none"></div>
    </section>
  </main>

  <footer>
    Offline‑ready • Add to Home Screen in Safari • v1.0
  </footer>
</div>

<script>
// ---- Utilities ----
const fmtDate = (d=new Date())=> d.toLocaleDateString(undefined,{weekday:'short', month:'short', day:'numeric'});
const todayKey = ()=> new Date().toISOString().slice(0,10);
const LS_KEY = 'moodspin-v1';
const load = () => { try { return JSON.parse(localStorage.getItem(LS_KEY))||{} } catch { return {} } };
const save = s => localStorage.setItem(LS_KEY, JSON.stringify(s));

// State shape: { entries:{[date]:{mood:number, energy:number, note:string}}, tasks:[string] }
const EMOJI = ['😣','🙁','😐','🙂','😀']; // 1..5
const ENERGY = ['Low','Med','High'];     // 1..3

const moodRow = document.getElementById('moodRow');
const energyRow = document.getElementById('energyRow');
const noteEl = document.getElementById('note');
const historyEl = document.getElementById('history');
const spinResult = document.getElementById('spinResult');

function ensureState(){ const s=load(); s.entries=s.entries||{}; s.tasks=s.tasks||['Dishes','Tidy 5 min','Wipe counters','Water plants']; save(s); }

function renderHeader(){ document.getElementById('today').textContent = fmtDate(); }

function renderMoodEnergy(){
  const s=load(); const d=todayKey(); const e=s.entries[d]||{};
  moodRow.innerHTML='';
  EMOJI.forEach((em,i)=>{
    const b=document.createElement('button'); b.className='chip'+(e.mood===i+1?' active':''); b.textContent=em; b.onclick=()=>{ e.mood=i+1; s.entries[d]=e; save(s); renderMoodEnergy(); renderHistory(); };
    moodRow.appendChild(b);
  });
  energyRow.innerHTML='';
  ENERGY.forEach((lbl,i)=>{
    const b=document.createElement('button'); b.className='chip'+(e.energy===i+1?' active':''); b.textContent='⚡ '+lbl; b.onclick=()=>{ e.energy=i+1; s.entries[d]=e; save(s); renderMoodEnergy(); renderHistory(); };
    energyRow.appendChild(b);
  });
  noteEl.value = e.note||'';
}

function renderHistory(){
  const s=load(); historyEl.innerHTML='';
  for(let i=6;i>=0;i--){
    const dt=new Date(); dt.setDate(dt.getDate()-i); const key=dt.toISOString().slice(0,10);
    const e=s.entries[key];
    const dot=document.createElement('div'); dot.className='dot';
    if(e && e.mood){ dot.classList.add('m'+e.mood); }
    dot.title = (e? `${dt.toDateString()} • Mood ${e.mood||'-'} • Energy ${e.energy||'-'}` : dt.toDateString());
    historyEl.appendChild(dot);
  }
}

// Save button commits note too
function saveToday(){ const s=load(); const d=todayKey(); const e=s.entries[d]||{}; e.note = noteEl.value.trim(); s.entries[d]=e; save(s); spinResult.style.display='block'; spinResult.textContent='Saved ✓'; setTimeout(()=>{ spinResult.style.display='none'; }, 1200); }

// Spinner
function renderTasks(){ const s=load(); const list=document.getElementById('taskList'); list.innerHTML=''; s.tasks.forEach((t,idx)=>{ const p=document.createElement('span'); p.className='pill'; p.textContent=t; p.title='Tap to remove'; p.onclick=()=>{ s.tasks.splice(idx,1); save(s); renderTasks(); }; list.appendChild(p); }); }
function addTask(){ const inp=document.getElementById('newTask'); const v=inp.value.trim(); if(!v) return; const s=load(); s.tasks.push(v); save(s); inp.value=''; renderTasks(); }
function spinTask(){ const s=load(); if(!s.tasks.length){ alert('Add a task first'); return; } const pick = s.tasks[Math.floor(Math.random()*s.tasks.length)]; spinResult.style.display='block'; spinResult.innerHTML = `<strong>Do this now:</strong> ${pick}`; }

// Share + Wipe
function shareTip(){ if(navigator.share){ navigator.share({title:'Mood & Spin', text:'Add to Home Screen for app‑like mode', url:location.href}); } else alert('In Safari, tap Share → Add to Home Screen'); }
function wipe(){ if(confirm('Wipe all data?')){ localStorage.removeItem(LS_KEY); location.reload(); } }

// Init
ensureState();
renderHeader();
renderMoodEnergy();
renderHistory();
renderTasks();

document.getElementById('saveBtn').onclick = saveToday;
document.getElementById('addBtn').onclick = addTask;
document.getElementById('spinBtn').onclick = spinTask;
document.getElementById('shareBtn').onclick = shareTip;
document.getElementById('wipeBtn').onclick = wipe;

// Register SW for offline
if('serviceWorker' in navigator){
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('./service-worker.js').catch(console.error);
  });
}
</script>
</body>
</html>
